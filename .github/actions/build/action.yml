name: Build
description: Runs local tests, builds APKs, and uploads build artifacts.
inputs:
  gradle-cache-encryption-key:
    description: Gradle cache encryption key used by setup-gradle.
    required: false
runs:
  using: composite
  steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Copy CI gradle.properties
      run: mkdir -p ~/.gradle ; cp .github/ci-gradle.properties ~/.gradle/gradle.properties
      shell: bash

    - name: Set up JDK 21
      uses: actions/setup-java@v5
      with:
        distribution: 'zulu'
        java-version: 21

    - name: Setup Gradle
      uses: gradle/actions/setup-gradle@v4
      with:
        cache-encryption-key: ${{ inputs.gradle-cache-encryption-key }}
        build-scan-publish: true
        build-scan-terms-of-use-url: "https://gradle.com/terms-of-service"
        build-scan-terms-of-use-agree: "yes"

    - name: Processs Watcher 
      uses: cdsap/build-process-watcher@fix/composite-run-id-file
      with:
         remote_monitoring: false
         debug: true

    - name: Check build-logic
      run: ./gradlew :build-logic:convention:check
      shell: bash

    - name: Processs Watcher 
      uses: cdsap/build-process-watcher@fix/composite-run-id-file
      with:
         remote_monitoring: false

    - name: Check spotless
      run: ./gradlew spotlessCheck
      shell: bash
